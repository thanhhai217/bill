<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Tạo & Kiểm Tra Bill</title>
</head>
<body>
    <h2>Test API Tạo Bill</h2>
    <label for="purpose">Mục đích:</label>
    <input type="text" id="purpose" placeholder="Nhập mục đích bill">
    <br>
    <label for="date">Ngày:</label>
    <input type="date" id="date">
    <br>
    <label for="total">Tổng tiền:</label>
    <input type="number" id="total" placeholder="Nhập tổng số tiền">
    <br>
    <label for="creator">Email người tạo:</label>
    <input type="email" id="creator" placeholder="Nhập email">
    <br>
    <label for="participants">Người tham gia (Email - Số tiền, cách nhau bởi dấu phẩy):</label>
    <input type="text" id="participants" placeholder="test@example.com - 100000">
    <br>
    <button onclick="createBill()">Tạo Bill</button>
    <h3>Kết quả:</h3>
    <div id="result"></div>

    <h2>Kiểm Tra Bill</h2>
    <label for="checkEmail">Email:</label>
    <input type="email" id="checkEmail" placeholder="Nhập email để kiểm tra bill">
    <button onclick="checkBills()">Kiểm tra Bill</button>
    <h3>Danh sách Bill:</h3>
    <div id="bills"></div>

    <script>
        const API_BASE_URL = "https://n8n.thanhhai217.com/webhook-test"; // Thay bằng API webhook của bạn
        
        function createBill() {
            const purpose = document.getElementById("purpose").value;
            const date = document.getElementById("date").value;
            const total_amount = document.getElementById("total").value;
            const creator_email = document.getElementById("creator").value;
            const participantsInput = document.getElementById("participants").value;
            
            const participants = participantsInput.split(",").map(p => {
                const [email, amount] = p.trim().split(" - ");
                return { email, amount_due: parseFloat(amount) };
            });

            fetch(`${API_BASE_URL}/create-bill`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ purpose, date, total_amount, creator_email, participants })
            })
            .then(response => response.json())
            .then(data => document.getElementById("result").innerText = JSON.stringify(data, null, 2))
            .catch(error => document.getElementById("result").innerText = "Lỗi: " + error);
        }

        function checkBills() {
            const email = document.getElementById("checkEmail").value;
            fetch(`${API_BASE_URL}/get-bills/${email}`)
            .then(response => response.json())
            .then(data => document.getElementById("bills").innerText = JSON.stringify(data, null, 2))
            .catch(error => document.getElementById("bills").innerText = "Lỗi: " + error);
        }
    </script>
</body>
</html>
